var games = 
[
    [ 
        { letter: "a", answer: "anarquista", status: 0, question: ("Empieza por A: Que no tiene ni dios ni patria ni amo.") },
        { letter: "a", answer: "anecdota", status: 0, question: ("Empieza por A: Relato breve de un acontecimiento extraño, curioso o divertido, generalmente ocurrido a la persona que lo cuenta.") },
        { letter: "a", answer: "abducir", status: 0, question: ("CON LA A. Dicho de una supuesta criatura extraterrestre: Apoderarse de alguien") }
    ],
    [
        { letter: "b", answer: "bisiesto", status: 0, question: ("Empieza por B: Año que dura 366 días.") },
        { letter: "b", answer: "bollo" , status: 0 , question: ("Empieza por B: Pasta dulce y esponjosa, hecha con harina, huevos, levadura y otros ingredientes, que puede tener distintas formas.") },
        { letter: "b", answer: "bingo", status: 0, question: ("CON LA B. Juego que ha sacado de quicio a todos los 'Skylabers' en las sesiones de precurso") }

    ],
    [
        { letter: "c", answer: "calendario", status: 0, question: ("Empieza por C: Sistema de división del tiempo.") },
        { letter: "c", answer: "cascada", status: 0, question: ("Empieza por C: Corriente de agua que cae desde cierta altura a causa de un brusco desnivel en su cauce, especialmente en un río.") },
        { letter: "c", answer: "churumbel", status: 0, question: ("CON LA C. Niño, crío, bebé") }
    ],
    [
        { letter: "d", answer: "día", status: 0, question: ("Empieza por D: Tiempo que la Tierra emplea en dar una vuelta alrededor de su eje, aproximadamente veinticuatro horas.") },
        { letter: "d", answer: "daga", status: 0, question: ("Empieza por D: Arma blanca de hoja corta, ancha y puntiaguda, parecida a la espada pero de menor tamaño.") },
        { letter: "d", answer: "diarrea", status: 0, question: ("CON LA D. Anormalidad en la función del aparato digestivo caracterizada por frecuentes evacuaciones y su consistencia líquida") }
    ],
    [   
        { letter: "e", answer: "espiral", status: 0, question: ("Empieza por E: Línea curva que describe varias vueltas alrededor de un punto, alejándose cada vez más de él.") },
        { letter: "e", answer: "estocolmo", status: 0, question: ("Empeiza por E: Capital de Suecia.") },
        { letter: "e", answer: "ectoplasma", status: 0, question: ("CON LA E. Gelatinoso y se encuentra debajo de la membrana plasmática. Los cazafantasmas medían su radiación") }
    ],
    [   
        { letter: "f", answer: "putrefacto", status: 0, question: ("Contiene la F: Que está descompuesto o podrido por la acción de diversos factores y determinados microorganismos.") },
        { letter: "f", answer: "finiquito", status: 0, question: ("Empeiza con la F. Remate de las cuentas, o certificación que se da para constancia de que están ajustadas y satisfecho el alcance que resulta de ellas.") },
        { letter: "f", answer: "facil", status: 0, question: ("CON LA F. Que no requiere gran esfuerzo, capacidad o dificultad") }
    ],
    [   
        { letter: "g", answer: "gregorio", status: 0, question: ("Empieza por G: Papa que da nombre a nuestro calendario actual.") },
        { letter: "g", answer: "garrulo", status: 0, question: ("Empieza por la G: Que se comporta de manera ruda, tosca o grosera.") },
        { letter: "g", answer: "galaxia", status: 0, question: ("CON LA G. Conjunto enorme de estrellas, polvo interestelar, gases y partículas") }
    ],
    [
        { letter: "h", answer: "hijo", status: 0, question: ("Empieza por H: El orgullo del padre.") },
        { letter: "h", answer: "rechoncho", status: 0, question: ("Contiene la H: Persona o animal que es grueso y de poca altura.") },
        { letter: "h", answer: "harakiri", status: 0, question: ("CON LA H. Suicidio ritual japonés por desentrañamiento") }
    ],
    [
        { letter: "i", answer: "india", status: 0, question: ("Empieza por I: Segundo pais del mundo más habitado.") },
        { letter: "i", answer: "interestelar", status: 0, question: ("Empieza por I: Que está en el espacio existente entre dos astros, o que tiene relación con él.") },
        { letter: "i", answer: "iglesia", status: 0, question: ("CON LA I. Templo cristiano") }
    ],
    [   
        { letter: "j", answer: "juerga", status: 0, question: ("Empieza por J: Fiesta sin fin.") },
        { letter: "j", answer: "jalapeño", status: 0, question: ("Empieza por J: Chile picante de unos 5 cm de largo, carnoso y de punta redonda, que se usa para condimentar ciertos guisos.") },
        { letter: "j", answer: "jabali", status: 0, question: ("CON LA J. Variedad salvaje del cerdo que sale en la película 'El Rey León', de nombre Pumba") }
    ],
    [
        { letter: "k", answer: "punky", status: 0, question: ("Contiene la K: El jabón de lagarto le aguanta la cresta.") },
        { letter: "k", answer: "kryptonita", status: 0, question: ("Empieza por K: Mineral ficticio que aparece en los cómics de Superman de DC Comics.") },
        { letter: "k", answer: "kamikaze", status: 0, question: ("CON LA K. Persona que se juega la vida realizando una acción temeraria") }
    ],
    [
        { letter: "l", answer: "leviatán", status: 0, question: ("Contiene la L: Monstruo de las profundidades marinas.") },
        { letter: "l", answer: "homunculo", status: 0, question: ("Contiene la L: Hombre pequeño y débil.") },
        { letter: "l", answer: "licantropo", status: 0, question: ("CON LA L. Hombre lobo") }
    ],
    [
        { letter: "m", answer: "muermo", status: 0, question: ("Empieza por M: Soso, aburrido.") },
        { letter: "m", answer: "martir", status: 0, question: ("Empieza por M: Persona que sufre o muere por defender su religión o sus ideales.") },
        { letter: "m", answer: "misantropo", status: 0, question: ("CON LA M. Persona que huye del trato con otras personas o siente gran aversión hacia ellas") }
    ],
    [
        { letter: "n", answer: "necedad", status: 0, question: ("CON LA N. Demostración de poca inteligencia") },
        { letter: "n", answer: "necrófilo", status: 0, question: ("Empieza por N: Que le gustan los muertos.") },
        { letter: "n", answer: "neon", status: 0, question: ("Empieza por N: Tubo fluorescente que produce una luz brillante.") },
    ],
    [
        { letter: "o", answer: "ornitorrinco", status: 0, question: ("Empieza por O: Único mamifero que pone huevos.") },
        { letter: "o", answer: "omnisciente", status: 0, question: ("Empieza por O: Que conoce todas las cosas reales y posibles.") },
        { letter: "o", answer: "orco", status: 0, question: ("CON LA O. Humanoide fantástico de apariencia terrible y bestial, piel de color verde creada por el escritor Tolkien") }
    ],
    [
        { letter: "p", answer: "perejil", status: 0, question: ("Empieza por P: No falta en un plato de Arguiñano") },
        { letter: "p", answer: "alpargata", status: 0, question: ("Contiene la P: Calzado de lona, con suela de esparto, cáñamo o goma, que se sujeta al pie por presión o con unas cintas que se atan al tobillo.") },
        { letter: "p", answer: "protoss", status: 0, question: ("CON LA P. Raza ancestral tecnológicamente avanzada que se caracteriza por sus grandes poderes psíonicos del videojuego StarCraft") }
    ],
    [
        { letter: "q", answer: "quemar", status: 0, question: ("Empieza por Q: Arder, combustionar.") },
        { letter: "q", answer: "quebradizo", status: 0, question: ("Empieza por Q: Que se puede romper fácilmente.") },
        { letter: "q", answer: "queso", status: 0, question: ("CON LA Q. Producto obtenido por la maduración de la cuajada de la leche") }
    ],
    [
        { letter: "r", answer: "reglas", status: 0, question: ("Empieza por R: Se rompen o se cumplen.") },
        { letter: "r", answer: "rinoplastia", status: 0, question: ("Empieza por R: Operación quirúrgica para restaurar la nariz.") },
        { letter: "r", answer: "raton", status: 0, question: ("CON LA R. Roedor") }
    ],
    [
        { letter: "s", answer: "pésimo", status: 0, question: ("Contiene la S: Peor que malo.") },
        { letter: "s", answer: "sesaliño", status: 0, question: ("Contiene la S: Falta de cuidado en la forma de vestir y en el aseo personal.") },
        { letter: "s", answer: "stackoverflow", status: 0, question: ("CON LA S. Comunidad salvadora de todo desarrollador informático") }
    ],
    [
        { letter: "t", answer: "teruel", status: 0, question: ("Empieza por T: Para algunos existe.") },
        { letter: "t", answer: "tabardillo", status: 0, question: ("Empieza por T: Persona alocada, bulliciosa y molesta.") },
        { letter: "t", answer: "terminator", status: 0, question: ("CON LA T. Película del director James Cameron que consolidó a Arnold Schwarzenegger como actor en 1984") }
    ],
    [
        { letter: "u", answer: "urbanita", status: 0, question: ("Empieza por U: Dícese del que es muy de ciudad.") },
        { letter: "u", answer: "huraño", status: 0, question: ("Contiene la U: Persona que rehúye el trato de otras personas y rechaza las atenciones y muestras de cariño.") },
        { letter: "u", answer: "unamuno", status: 0, question: ("CON LA U. Escritor y filósofo español de la generación del 98 autor del libro 'Niebla' en 1914") }
    ],
    [   
        { letter: "v", answer: "valiente", status: 0, question: ("Empieza por V: Contrario de cobarde.") },
        { letter: "v", answer: "vasallaje", status: 0, question: ("Empieza por V: Tributo que el vasallo pagaba a su señor o servicio que le prestaba según este vínculo.") },
        { letter: "v", answer: "vikingos", status: 0, question: ("CON LA V. Nombre dado a los miembros de los pueblos nórdicos originarios de Escandinavia, famosos por sus incursiones y pillajes en Europa") }
    ],
    [
        { letter: "w", answer: "westfalia", status: 0, question: ("Empieza por W: La cama en el techo de las furgonetas.") },
        { letter: "w", answer: "wolframio", status: 0, question: ("Empieza por la W. Elemento químico de número atómico 74 que se encuentra en el grupo 6 de la tabla periódica de los elementos. Su símbolo es W. ") },
        { letter: "w", answer: "sandwich", status: 0, question: ("CONTIENE LA W. Emparedado hecho con dos rebanadas de pan entre las cuales se coloca jamón y queso") }
    ],
    [
        { letter: "x", answer: "climax", status: 0, question: ("Contiene la X: Punto culminante o de mayor satisfacción de la excitación sexual en las zonas erógenas o sexuales.") },
        { letter: "x", answer: "taxidermista", status: 0, question: ("Contiene la X: El que tiene el oficio de disecar.") },
        { letter: "x", answer: "botox", status: 0, question: ("CONTIENE LA X. Toxina bacteriana utilizada en cirujía estética") },
    ],   
    [
        { letter: "y", answer: "yamaha", status: 0, question: ("Empieza por Y: La marca del diapasón.") },
        { letter: "y", answer: "buey", status: 0, question: ("Contiene la Y: Toro castrado, que se utiliza como animal de tiro y del cual se aprovecha su carne.") },
        { letter: "y", answer: "peyote", status: 0, question: ("CONTIENE LA Y. Pequeño cáctus conocido por sus alcaloides psicoactivos utilizado de forma ritual y medicinal por indígenas americanos") }
    ],   
    [
        { letter: "z", answer: "zoquete", status: 0, question: ("Empieza por Z: Duro de mollera.") },
        { letter: "z", answer: "pazguato", status: 0, question: ("Contiene la Z: Que es tonto o tiene poca rapidez mental.") },
        { letter: "z", answer: "zen", status: 0, question: ("CON LA Z. Escuela de budismo que busca la experiencia de la sabiduría más allá del discurso racional") }
      ]         
]//status = 0 --> not answered, status = 1 --> correct, status = 2 --> wrong

var questions = [];
var numQuestion, question, answer, timing;
var response = [];
var results = [];
var ranking = [];
var username;
var wrong_audio = new Audio('sounds/wrong_audio.mov');
var correct_audio = new Audio('sounds/correct_audio.mov');

/*creates and array with objects choosed randomly 
*/
function createQuestions(){
    for(var i=0;i<games.length;i++){
        questions.push(games[i][random()]);
    }
}

/*return randomly 0 or 1.
*@return {number} 
*/
function random(){
    return Math.floor(Math.random() * (2 - 0 + 1)) + 0;
}

/*selects the question to answer and gives the next index question
*@param {number} numQuestions
*@param {array of objects} questions
*@return {array} response 
*/
function selectQuestion(numQuestion){
    console.log(numQuestion);
    var response = [];
    for(var i = numQuestion; i < questions.length; i++){
        if(questions[i].status === 0){
            response.push(questions[i].question);
            response.push(i);
            return response; 
        }
    }   
    return ['',0];
}

/*classify the different types of answers depending on correct/incorrect/passed
*@param {array of objects} questions
*@return {array} results
*/
function points(){
    var correct = 0;
    var incorrect = 0;
    var notAnswered = 0;
    var results = [];

    questions.forEach(function(obj){
        if(obj.status === 1){
            correct++;
        }
        else if(obj.status === 2){
            incorrect++;
        }
        else if(obj.status === 0){
            notAnswered++;
        }
    });

    results.push(correct);
    results.push(incorrect);
    results.push(notAnswered);

    return results;
}

/*corrects all Upper/Lowers case answers returning always a lowercase word
*@param {string} word
*@return {string} 
*/
function caseSensitive(word){
    return word.toLowerCase();
}

/*Shows the question.
*@param {string} question
*/
function showQuestion(question){
    document.getElementById("quest1").innerHTML = question;
}

/*Controls if the answer is correct, incorrect or the user passed the question
*@param {array of objects} questions
*@param {string} answer
*@param {number} numQuestion
*@return {array of objects} questions
*/
function controlAnswer(answer, numQuestion){
    if(answer === ''){
        return questions;
    }
    else if(questions[numQuestion].answer === answer){
        questions[numQuestion].status = 1;
        document.getElementById(questions[numQuestion].letter).style.background = "lightgreen";
        correct_audio.play();
        return questions;
    }
    else{
        questions[numQuestion].status = 2;
        document.getElementById(questions[numQuestion].letter).style.background = "lightcoral";
        wrong_audio.play();
        return questions;
    }
}

/*updates the ranking with the different data of the user
*@param {array of objects} ranking
*@param {string} name
*@param {array} arrPoints 
*@return {array of objects} ranking
*/
function updateRanking(ranking, name, results){
    ranking.push({username: name, points: results[0]});
    return ranking;
}

/*shows the ranking sorted in the HTML 
*@param {array of objects} ranking
*/
function showRanking(ranking){
    var show;

    ranking.sort(function(a,b){
        return b.points - a.points;
    });
    for(var i = 0; i < ranking.length; i++){
        show = ((i+1)+'.- '+ranking[i].username+' - '+ranking[i].points);

        var ul = document.getElementById("list");
        var li = document.createElement("li");
        li.appendChild(document.createTextNode(show));
        ul.appendChild(li);
    }
}

/*Returns a true/false depending if all the questions are answered
*@return {boolean} result
*/
function isAllAnswered(){
    var count = 0;
    questions.forEach(function(obj){
        if(obj.status === 0){
            count++;
        }
    });
    return count === 0 ? true : false;
}

/*updates the points in the HTML
*/
function updatePoints(){
    results = points();
    document.getElementById("points1").innerHTML = results[0];
}3

/*change html and css style for play a new game from the start again
*/
function repaint(){
    questions.forEach(function(obj){
        document.getElementById(obj.letter).style.background = "#fff";
        document.getElementById(obj.letter).classList.remove('actual');
    });

    document.getElementById("points1").innerHTML = 0;
    document.getElementById("quest1").innerHTML = '';
    document.getElementById("time1").innerHTML = 130;
}

/*show the final result in the HTML
*/
function showTotal(){
    var total_results = points();
    document.getElementById('total').innerHTML = 'Correctas: '+total_results[0]+' || Incorrectas: '+total_results[1]+' || Pasapalabra: '+total_results[2];
}

/*show the modal of the game when is finished
*/
function gameOver(){
    var li = document.getElementById('list');
    li.innerHTML = '';
    var modal = document.getElementById('modalTime');
    modal.style.display = "block";   
    updateRanking(ranking, username, results);
    showRanking(ranking);
    showTotal();
    var span = document.getElementsByClassName("close")[0];
    span.onclick = function(){
        modal.style.display = "none";
    }
}
/*wait for username to introduce the nick 
*/
function getName(){
    document.getElementById('submitName').onclick = function(){
        username = document.getElementById("username").value;
        document.getElementById('modalStart').style.display = "none";
    };
    document.getElementById('username').innerHTML = '';
}

/*reinicialize varaiables, HTML, names to play again
*/
function playAgain(){
    reinicialize();
    repaint();
    //clean ranking HTML
    var li = document.getElementById('list');
    li.innerHTML = '';
    //display 'none' for gameover modal 
    var modal = document.getElementById('modalTime');
    modal.style.display = "none";
    //display 'block' for start modal 
    document.getElementById('modalStart').style.display = "block";
    getName();

    document.getElementById("start").disabled = false;
    document.getElementById("submit").disabled = false;

    questions = [];
    createQuestions();
}

/*get the answer with the event key 
*@param {event} event
*/
function enter(event){
    var key = (document.all) ? event.keyCode : event.which;
    if(key === 13){
        getAnswer();
        event.preventDefault();
    }
}

//main function while playing 
function getAnswer(){
    document.getElementById(questions[numQuestion].letter).classList.remove('actual');
    answer = document.getElementById("answer").value;
    document.getElementById('answer').value = '';
    answer = caseSensitive(answer);
    questions = controlAnswer(answer, numQuestion);
    if(numQuestion < 25){
        numQuestion++;
    }
    else{
        numQuestion = 0;
    }
    updatePoints();
    response = selectQuestion(numQuestion);
    question = response[0];
    numQuestion = response[1];
    document.getElementById(questions[numQuestion].letter).classList.add('actual');
    showQuestion(question);
    
}
//to control the new events in a new game
function newGame(){
    numQuestion = 0;
    timing = 130;
    response = [];
    response = selectQuestion(numQuestion);
    question = response[0];
    numQuestion = response[1];
    showQuestion(question);
    document.getElementById(questions[numQuestion].letter).classList.add('actual');
    var interval = setInterval(function(){ 
        timing--; 
        document.getElementById("time1").innerHTML = timing;
        if(timing === 0 || isAllAnswered()){
            clearInterval(interval);     
            gameOver();
            document.getElementById("submit").disabled = true;
        }     
    }, 1000);
    document.getElementById("start").disabled = true;
}
//when windows loads the function starts
window.onload = function(){
    createQuestions();
    getName();
};